#!/bin/bash

if [ $# -lt 2 ]; then
    echo "WhatsApp Bulk Sender v1.0"
    echo "Usage: whatsapp-sender <numbers_file> <message>"
    echo ""
    echo "Example:"
    echo "  whatsapp-sender numbers.txt \"Hello! Test message\""
    exit 1
fi

NUMBERS_FILE="$1"
MESSAGE="$2"

if [ ! -f "$NUMBERS_FILE" ]; then
    echo "Error: Numbers file not found"
    exit 1
fi

echo "========================================"
echo "   WhatsApp Bulk Sender v1.0"
echo "========================================"
echo ""
echo "Numbers file: $NUMBERS_FILE"
echo "Message: $MESSAGE"
echo ""

OUTPUT="whatsapp_links.html"

# URL encode message
ENCODED_MSG=$(echo "$MESSAGE" | sed 's/ /%20/g' | sed 's/!/%21/g')

# Count numbers
COUNT=$(grep -c . "$NUMBERS_FILE")

echo "Creating WhatsApp links..."

cat > "$OUTPUT" << 'EOF'
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WhatsApp Bulk Sender</title>
    <style>
        body{font-family:Arial;background:linear-gradient(135deg,#25D366,#128C7E);padding:20px;min-height:100vh;}
        .container{max-width:900px;margin:0 auto;background:white;border-radius:15px;padding:40px;box-shadow:0 20px 60px rgba(0,0,0,0.3);}
        h1{color:#25D366;text-align:center;font-size:2.5em;}
        .stats{background:#f0f9ff;padding:20px;border-radius:10px;margin:20px 0;border-left:4px solid #25D366;}
        .message-preview{background:#fff9e6;padding:20px;border-radius:10px;margin:20px 0;border-left:4px solid #ffc107;}
        .link-card{background:#f8f9fa;padding:15px 20px;margin:10px 0;border-radius:8px;display:flex;justify-content:space-between;align-items:center;transition:all 0.3s;}
        .link-card:hover{background:#e8f5e9;transform:translateX(5px);}
        .number{font-size:1.1em;font-weight:bold;}
        .whatsapp-btn{background:#25D366;color:white;padding:12px 30px;border-radius:25px;text-decoration:none;font-weight:bold;transition:all 0.3s;}
        .whatsapp-btn:hover{background:#128C7E;transform:scale(1.05);}
        .counter{position:fixed;top:20px;right:20px;background:white;padding:15px 25px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.2);}
        .counter-number{font-size:2em;font-weight:bold;color:#25D366;}
    </style>
</head>
<body>
    <div class="counter">
        <div class="counter-number" id="count">0</div>
        <div>Sent</div>
    </div>
    <div class="container">
        <h1>ðŸ“± WhatsApp Bulk Sender</h1>
        <div class="stats">
            <p><strong>Total:</strong> COUNT_PLACEHOLDER numbers</p>
        </div>
        <div class="message-preview">
            <h3>ðŸ’¬ Message:</h3>
            <p>MESSAGE_PLACEHOLDER</p>
        </div>
        <h2>ðŸ“ž Recipients:</h2>
        <div id="links">
EOF

# Replace placeholders
sed -i "s/COUNT_PLACEHOLDER/$COUNT/g" "$OUTPUT"
sed -i "s|MESSAGE_PLACEHOLDER|$MESSAGE|g" "$OUTPUT"

# Add links for each number
i=1
while IFS= read -r number; do
    number=$(echo "$number" | tr -d ' \r\n')
    if [ -n "$number" ]; then
        echo "<div class='link-card'><span class='number'>$i. +$number</span><a href='https://wa.me/$number?text=$ENCODED_MSG' class='whatsapp-btn' target='_blank' onclick='document.getElementById(\"count\").textContent=parseInt(document.getElementById(\"count\").textContent)+1'>ðŸ“¤ Send</a></div>" >> "$OUTPUT"
        ((i++))
    fi
done < "$NUMBERS_FILE"

cat >> "$OUTPUT" << 'EOF'
        </div>
        <p style="text-align:center;margin-top:40px;color:#999;">WhatsApp Bulk Sender v1.0</p>
    </div>
</body>
</html>
EOF

echo ""
echo "âœ“ Done!"
echo "ðŸ“„ Output: $OUTPUT"
echo "ðŸ“Š Found $COUNT numbers"
echo ""
echo "Open $OUTPUT in your browser!"